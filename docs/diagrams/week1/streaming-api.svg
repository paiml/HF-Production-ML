<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 400">
  <defs>
    <linearGradient id="headerGrad4" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#6366F1"/>
      <stop offset="100%" style="stop-color:#8B5CF6"/>
    </linearGradient>
  </defs>

  <!-- Background -->
  <rect width="800" height="400" fill="#FAFAFA"/>

  <!-- Title -->
  <rect x="0" y="0" width="800" height="50" fill="url(#headerGrad4)"/>
  <text x="400" y="32" font-family="system-ui, sans-serif" font-size="20" font-weight="600" fill="white" text-anchor="middle">Streaming API: Server-Sent Events for Token Delivery</text>

  <!-- SSE Flow -->
  <g transform="translate(50, 70)">
    <text x="0" y="0" font-family="system-ui, sans-serif" font-size="14" font-weight="600" fill="#1E293B">Token Streaming Architecture</text>

    <g transform="translate(0, 25)">
      <!-- Client -->
      <rect x="0" y="20" width="120" height="80" rx="6" fill="#DBEAFE" stroke="#3B82F6"/>
      <text x="60" y="50" font-family="system-ui, sans-serif" font-size="12" font-weight="600" fill="#1E40AF" text-anchor="middle">Client</text>
      <text x="60" y="70" font-family="monospace" font-size="9" fill="#475569" text-anchor="middle">EventSource</text>
      <text x="60" y="85" font-family="monospace" font-size="9" fill="#475569" text-anchor="middle">text/event-stream</text>

      <!-- Arrow -->
      <path d="M 125 60 L 195 60" stroke="#94A3B8" stroke-width="2" fill="none"/>
      <text x="160" y="50" font-family="monospace" font-size="8" fill="#64748B" text-anchor="middle">POST /chat</text>

      <!-- Server -->
      <rect x="200" y="20" width="140" height="80" rx="6" fill="#DCFCE7" stroke="#10B981"/>
      <text x="270" y="50" font-family="system-ui, sans-serif" font-size="12" font-weight="600" fill="#166534" text-anchor="middle">Inference Server</text>
      <text x="270" y="70" font-family="monospace" font-size="9" fill="#475569" text-anchor="middle">Async generator</text>
      <text x="270" y="85" font-family="monospace" font-size="9" fill="#475569" text-anchor="middle">yield tokens</text>

      <!-- Streaming arrows -->
      <g transform="translate(345, 35)">
        <path d="M 0 0 L 50 0" stroke="#10B981" stroke-width="2" stroke-dasharray="5,3"/>
        <path d="M 0 15 L 50 15" stroke="#10B981" stroke-width="2" stroke-dasharray="5,3"/>
        <path d="M 0 30 L 50 30" stroke="#10B981" stroke-width="2" stroke-dasharray="5,3"/>
        <text x="25" y="50" font-family="monospace" font-size="8" fill="#10B981" text-anchor="middle">SSE events</text>
      </g>

      <!-- Token display -->
      <rect x="400" y="20" width="180" height="80" rx="6" fill="#FEF3C7" stroke="#F59E0B"/>
      <text x="490" y="40" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="#92400E" text-anchor="middle">Real-time Token Display</text>
      <text x="490" y="60" font-family="monospace" font-size="10" fill="#475569" text-anchor="middle">The quick brown fox█</text>
      <text x="490" y="80" font-family="monospace" font-size="8" fill="#64748B" text-anchor="middle">TTFT: 45ms │ ITL: 25ms</text>
    </g>
  </g>

  <!-- SSE Event Format -->
  <g transform="translate(50, 195)">
    <text x="0" y="0" font-family="system-ui, sans-serif" font-size="14" font-weight="600" fill="#1E293B">SSE Event Format (OpenAI Compatible)</text>

    <g transform="translate(0, 20)">
      <rect x="0" y="0" width="350" height="130" rx="4" fill="#1E293B"/>

      <text x="15" y="20" font-family="monospace" font-size="10" fill="#10B981">data: {"choices":[{"delta":{"content":"The"}}]}</text>
      <text x="15" y="38" font-family="monospace" font-size="10" fill="#10B981">data: {"choices":[{"delta":{"content":" quick"}}]}</text>
      <text x="15" y="56" font-family="monospace" font-size="10" fill="#10B981">data: {"choices":[{"delta":{"content":" brown"}}]}</text>
      <text x="15" y="74" font-family="monospace" font-size="10" fill="#10B981">data: {"choices":[{"delta":{"content":" fox"}}]}</text>
      <text x="15" y="92" font-family="monospace" font-size="10" fill="#F59E0B">data: {"choices":[{"finish_reason":"stop"}]}</text>
      <text x="15" y="110" font-family="monospace" font-size="10" fill="#EF4444">data: [DONE]</text>
      <text x="15" y="125" font-family="monospace" font-size="10" fill="#64748B"></text>
    </g>
  </g>

  <!-- Latency Metrics -->
  <g transform="translate(420, 195)">
    <text x="0" y="0" font-family="system-ui, sans-serif" font-size="14" font-weight="600" fill="#1E293B">Key Latency Metrics</text>

    <g transform="translate(0, 20)">
      <rect x="0" y="0" width="330" height="130" rx="4" fill="#F8FAFC" stroke="#E2E8F0"/>

      <!-- TTFT -->
      <g transform="translate(15, 15)">
        <rect x="0" y="0" width="140" height="50" rx="3" fill="#DBEAFE" stroke="#3B82F6"/>
        <text x="70" y="20" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="#1E40AF" text-anchor="middle">TTFT</text>
        <text x="70" y="35" font-family="monospace" font-size="9" fill="#475569" text-anchor="middle">Time to First Token</text>
        <text x="70" y="47" font-family="monospace" font-size="9" fill="#3B82F6" text-anchor="middle">10-100ms target</text>
      </g>

      <!-- ITL -->
      <g transform="translate(170, 15)">
        <rect x="0" y="0" width="140" height="50" rx="3" fill="#DCFCE7" stroke="#10B981"/>
        <text x="70" y="20" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="#166534" text-anchor="middle">ITL</text>
        <text x="70" y="35" font-family="monospace" font-size="9" fill="#475569" text-anchor="middle">Inter-Token Latency</text>
        <text x="70" y="47" font-family="monospace" font-size="9" fill="#10B981" text-anchor="middle">20-50ms target</text>
      </g>

      <!-- Formula -->
      <g transform="translate(15, 75)">
        <text x="0" y="15" font-family="monospace" font-size="10" fill="#475569">Total Latency = TTFT + (n-1) × ITL</text>
        <text x="0" y="35" font-family="monospace" font-size="10" fill="#64748B">100 tokens @ 50ms ITL = ~5 seconds</text>
        <text x="0" y="50" font-family="monospace" font-size="10" fill="#64748B">Streaming: perceived latency = TTFT</text>
      </g>
    </g>
  </g>

  <!-- Footer -->
  <text x="400" y="385" font-family="system-ui, sans-serif" font-size="10" fill="#94A3B8" text-anchor="middle">Course 5: Production ML with Hugging Face | Week 1: Inference Fundamentals</text>
</svg>
